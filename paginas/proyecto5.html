<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AdGuard</title>
    <style>
      :root {
        --bg: #000000;
        --text: #ffffff;
        --muted: #ffffff;
        --border: #ffffff;
        --accent: #2563eb;
        --card: #18181b;
        --code-bg: #373636;
        --code-text: #ffffff;
      }

      * { box-sizing: border-box; margin: 0; padding: 0; }

      body {
        font-family: 'Inter', sans-serif;
        background: var(--bg);
        color: var(--text);
        line-height: 1.7;
      }

      a { color: var(--accent); text-decoration: none; font-weight: 500; }
      a:hover { text-decoration: underline; }

      header {
        max-width: 900px;
        margin: 0 auto;
        padding: 3rem 1.5rem 2rem;
        text-align: center;
      }

      header h1 {
        font-size: 2.8rem;
        font-weight: 700;
        letter-spacing: -0.04em;
      }

      nav ul {
        list-style: none;
        display: inline-flex;
        gap: 1.5rem;
        margin-top: 1rem;
        flex-wrap: wrap;
        justify-content: center;
      }

      .dropdown {
        position: relative;
      }

      .dropdown-menu {
        display: none;
        position: absolute;
        top: 100%;
        left: 0;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 8px;
        flex-direction: column;
        gap: 0;
        margin-top: 0.5rem;
        min-width: 200px;
        padding: 0.5rem 0;
      }

      .dropdown:hover .dropdown-menu {
        display: flex;
      }

      .dropdown-menu li {
        padding: 0.5rem 1rem;
      }

      .contenido {
        max-width: 900px;
        margin: 0 auto;
        padding: 0 1.5rem 4rem;
      }

      .card {
        background: var(--card);
        border-radius: 10px;
        padding: 1rem;
        margin-bottom: 1.5rem;
      }

      .contenido h1 {
        font-size: 2rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      .contenido h3 {
        font-size: 1.4rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
        margin-top: 1.5rem;
      }

      .contenido h4 {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
        margin-top: 1rem;
      }

      .contenido p {
        margin-bottom: 0.75rem;
        color: var(--muted);
      }

      .contenido ul {
        margin-left: 1.5rem;
        margin-bottom: 1rem;
      }

      .contenido ul li {
        margin-bottom: 0.5rem;
      }

      .contenido ol {
        margin-left: 1.5rem;
        margin-bottom: 1rem;
      }

      .contenido ol li {
        margin-bottom: 1rem;
      }

      code {
        display: block;
        background: var(--code-bg);
        color: var(--code-text);
        padding: 0.75rem 1rem;
        border-radius: 10px;
        font-size: 0.9rem;
        margin: 0.5rem 0 0.75rem;
        overflow-x: auto;
      }

      footer {
        border-top: 1px solid var(--border);
        padding: 2rem 1.5rem;
        text-align: center;
        color: var(--muted);
        font-size: 0.9rem;
      }

      @media (max-width: 600px) {
        header h1 { font-size: 2.2rem; }
        nav ul { flex-direction: column; gap: 1rem; }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Mi Portafolio</h1>
      <nav>
        <ul>
          <li><a href="../index.html">Inicio</a></li>
        </ul>
      </nav>
    </header>

    <section class="contenido">
      <h1>Proyecto 5: AdGuard</h1>
      
      <h3>Actualización técnica de mi proyecto de infraestructura con Raspberry Pi 4 y Docker</h3>
      
      <div class="card">
        <p>
          Durante las últimas semanas he estado trabajando en la modernización y reorganización de mi entorno doméstico basado en una Raspberry Pi 4.
          El objetivo principal del proyecto era conseguir un sistema más modular, limpio y fácil de mantener, 
          reduciendo la dependencia de scripts manuales y migrando los servicios a Docker para mejorar la portabilidad y la gestión.
        </p>
      </div>

      <h3>Migración de servicios a Docker</h3>

      <div class="card">
        <p>
          El primer paso fue trasladar diversos servicios que anteriormente 
          se ejecutaban directamente sobre el sistema operativo hacia contenedores. 
          Entre ellos:
        </p>
        <ul>
          <li>Jupyter Notebook, que utilizo para pruebas, análisis y prototipado.</li>
          <li>Nextcloud, para almacenamiento y sincronización de archivos.</li>
        </ul>
      </div>
      
      <div class="card">
        <p>
          Esta migración me permitió aislar cada servicio, mantener el sistema 
          operativo más limpio y facilitar su actualización o despliegue en caso de 
          reinstalación o cambio de equipo.
        </p>
      </div>
      
      <h3>Implementación de AdGuard Home</h3>
      <div class="card">
        <p>
          Uno de los servicios más importantes que implementé fue AdGuard Home, 
          con el objetivo de centralizar la resolución DNS de toda mi red y 
          añadir un sistema de filtrado y bloqueo de publicidad a nivel local.
        </p>
        <p>
          Para ello preparé un archivo <code>docker-compose.yml</code> que:
        </p>
        <ul>
          <li>Descarga la imagen oficial de AdGuard Home.</li>
          <li>Monta los volúmenes de configuración y datos.</li>
          <li>Expone los puertos necesarios:
            <ul>
              <li>53/UDP y TCP, este es el puerto del Servidor DNS.</li>
              <li>3000/TCP este puerto se usa para interfaz web inicial y de configuración.</li>
            </ul>
          </li>
        </ul>
      </div>
      
      <div class="card">
        <p>
          Una vez desplegado, el contenedor funcionaba correctamente y la interfaz web era accesible, 
          pero detecté un comportamiento anómalo: los dispositivos de mi red no estaban resolviendo DNS 
          a través de AdGuard, aunque la interfaz sí estaba operativa.
        </p>
      </div>
      
      <h3>Diagnóstico del conflicto con systemd-resolved</h3>
      
      <div class="card">
        <p>
          El problema estaba en el puerto 53, que aparecía ocupado por el servicio systemd-resolved, 
          nativo de Ubuntu. Para identificarlo utilicé herramientas como:
        </p>
        
          <code>sudo lsof -i :53</code></li>
          <code>sudo ss -tulpn | grep 53</code></li>
        
        <p>
          Ambas mostraban que el puerto estaba siendo utilizado por el servicio DNS interno del sistema.
        </p>
      </div>
      
      <div class="card">
        <p>
          Esto impedía que Docker asignara correctamente el puerto 53 al contenedor de AdGuard Home, provocando 
          que la interfaz web funcionara, pero el servidor DNS no estuviera activo a nivel de red.
        </p>
      </div>
      
      <h4>Solución: Deshabilitación de systemd-resolved</h4>
      
      <div class="card">
        <ol>
          <li>Desactivar systemd-resolved:
            <ul>
              <code>sudo systemctl stop systemd-resolved</code>
              <code>sudo systemctl disable systemd-resolved</code>
            </ul>
          </li>
          <li>Eliminar el enlace simbólico del archivo resolv.conf:
            <ul>
              <code>sudo rm /etc/resolv.conf</code>
            </ul>
          </li>
          <li>Crear un nuevo archivo resolv.conf con servidores DNS apuntando a AdGuard:
            <ul>
              <code>echo "nameserver 127.0.0.1" | sudo tee /etc/resolv.conf</code>
            </ul>
          </li>
          <li>Reiniciar el contenedor de AdGuard Home:
            <ul>
              <code>docker-compose down && docker-compose up -d</code>
            </ul>
          </li>
        </ol>
      </div>
      
      <div class="card">
        <p>
          Tras esto, AdGuard Home comenzó a funcionar como DNS principal de la Raspberry 
          Pi y ya podía gestionar las solicitudes del resto de dispositivos de la red.
        </p>
      </div>
      
      <h3>Pruebas avanzadas y validaciones</h3>
      
      <div class="card">
        <p>
          Durante una semana realicé distintas pruebas:
        </p>
        <ul>
          <li>Configuración manual del DNS en varios dispositivos (Android, Linux, Windows).</li>
          <li>Pruebas de bloqueo de dominios.</li>
          <li>Validaciones de rendimiento y latencia.</li>
          <li>Ajuste de listas de filtros y listas blancas.</li>
          <li>Supervisión de logs y estadísticas de resolución.</li>
        </ul>
      </div>
      
      <div class="card">
        <p>
          El resultado fue estable y consistente, demostrando que el servicio podía sustituir perfectamente al DNS tradicional.
        </p>
      </div>
      
      <h3>Automatización del encendido y apagado</h3>
      
      <div class="card">
        <p>
          Para optimizar energía y prolongar la vida útil del hardware, programé el encendido y apagado del sistema de la siguiente forma:
        </p>
        <ul>
          <li>Encendido físico: mediante un enchufe inteligente configurado para alimentar la Raspberry Pi a las 06:00.</li>
          <li>Apagado seguro del sistema: utilizando <code>crontab -e</code> para ejecutar un apagado ordenado a las 23:00.</li>
          <li>Apagado físico: el enchufe inteligente corta la alimentación unos minutos más tarde para asegurar que el sistema ya se apagó correctamente.</li>
        </ul>
      </div>
    </section>

    <footer>
      <p>2025 Izan · Todo ha sido creado por mí con una pequeña ayuda de ChatGPT</p>
    </footer>
  </body>
</html>